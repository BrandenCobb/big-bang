# Prerequisites:
* How the Prerequisites docs are organized:
  * This README.md is meant to be a high level overview of prerequsites.
  * /docs/guides/prerequsites/(some_topic).md files are meant to offer more specific guidance on prerequisites while staying generic. 
  * /docs/guides/deployment_scenarios/(some_topic).md files are may also offer additional details on prerequesites specific to the scenario. 
* Prerequisites vary depending on deployment scenario, thus a table is used to give an overview.
* Note for future edits: The following table was generated using tablesgenerator.com, recommended to copy the table's raw text contents, visit tablesgenerator.com, and File -> Paste table data when edits are needed.

| Prerequsites(rows) vs Deployment Scenarios(columns)                                                                                                              | QuickStart                                                                                                                                                                                                                                                                                                  | Internet Connected                                                                                                                                                                                           | Internet Disconnected                                                                                                                                                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| OS Preconfigured (1*) and Prehardened (OS and level of hardening required depends on AO)                                                                         | pre-req (non-hardened large CPU and RAM single node machine is recommended for demos)                                                                                                                                                                                                                       | CSPs usually have marketplaces with pre-hardened VM images                                                                                                                                                   | pre-req                                                                                                                                                                                                                     |
| Kubernetes Distribution Preconfigured to Best Practices (2*) and Prehardened (Any CNCF Kubernetes Distribution will work as long as an AO signs off on it)       | k3d is recommended for demos (It's quick to set up, works on every cloud and bare metal)                                                                                                                                                                                                                    | https://repo1.dso.mil/platform-one/distros                                                                                                                                                                   | pre-req (users are responsible for airgap image import of container images needed by chosen Kubernetes Distribution)                                                                                                        |
| Default Storage Class (for Dynamic PVCs), the SC needs to support RWX (read write many) to support all BigBang AddOns )                                                                                                                         | k3d has dynamic local volume storage class baked in                                                                                                                                                                                                                                                         | In most cases it's recommended to use a CSP specific storage class                                                                                                                                           | [BB Product team did a Cloud Agnostic Storage Solution research spike](https://repo1.dso.mil/platform-one/big-bang/bigbang/-/issues/260), (Note: No storage class specific container images exist in IronBank at this time) |
| Support for Automated Provisioning of Service Type Load Balancer is recommended                                                                                  | k3d ships with the ability to treat the VM's port 443 as Kubernetes Service of Type LB's port 443, automation in the quick start repo leverages these flags.                                                                                                                                                | CSPs usually include flags you can pass to the kube-apiserver to support auto provisioning of CSP LBs.                                                                                                       | pre-req (users are responsible for setting up [MetalLB](https://metallb.universe.tf/), [kubevip](https://kube-vip.io/), or external LB pointing to NodePorts)                                                               |
| IronBank Image Pull Credentials                                                                                                                                  | Anyone can go to login.dso.mil, and self register against P1's SSO. That can be used to login to registry1.dso.mil to generate image pull credentials for the QuickStart.                                                                                                                                   | BigBang customers are recommended to use ask their BB Customer Liaison's for an IronBank Image pull robot account, which lasts 6 months.                                                                     | [BigBang Releases](https://repo1.dso.mil/platform-one/big-bang/bigbang/-/releases) includes a .tar.gz of IronBank Images                                                                                                    |
| Customer Controlled Private Git Repo (for GitOps, the Cluster needs network access & Credentials for Read Access to said Git Repo)                               | PreSatisfied (the turn key demo points to public repo1, but you won't be able to customize it)                                                                                                                                                                                                              | pre-req (or follow Air gap docs)                                                                                                                                                                             | Air gap docs assist with provisioning an ssh based this                                                                                                                                                                     |
| Use SOPS + CSP KMS or PGP to encrypt secrets that need to be stored in the GitRepo                                                                               | PreSatisfied (Demo Repo has mock secrets encrypted with a demo PGP public encryption key)                                                                                                                                                                                                                   | pre-req (CSP KMS is more secure)                                                                                                                                                                             | pre-req (Use CSP KMS if available, PGP works universally, [Flux requires the private PGP key to not have a passphrase](https://toolkit.fluxcd.io/guides/mozilla-sops/#generate-a-gpg-key))                                  |
| Install and Configure Flux (Flux needs Git Repo Credentials & CSP IAM rights for KMS decryption or a kubernetes secret containing a private PGP decryption key ) | PreSatisfied (Demo Public Repo doesn't require RO Credentials, the demo PGP private decryption key is hosted cleartext in the repo)                                                                                                                                                                         | pre-req (see bigbang docs, [flux docs](https://toolkit.fluxcd.io/components/source/gitrepositories/#spec-examples) are also a good resource for this)                                                        | pre-req (see bigbang docs)                                                                                                                                                                                                  |
| HTTPS Certificates                                                                                                                                               | PreSatisfied (Demo Public Repo contains a Let's Encrypt Free (public internet recognised certificate authority) HTTPS Certificate for *.bigbang.dev, alternatively mkcert can be used to generate demo certs for arbitrary DNS names that will only be trusted by the laptop that provisoned the mkcert)    | pre-req (provided by user)                                                                                                                                                                                   | pre-req (provided by user)                                                                                                                                                                                                  |
| DNS                                                                                                                                                              | Edit your Laptop's host file (/etc/hosts, C:\Windows\System32\drivers\etc\hosts), or use something like AWS VPC Private DNS and [sshuttle](https://github.com/sshuttle/sshuttle) to point to host VM in the case of k3d                                                                                     | pre-req (point DNS names to Layer 4 CSP LB)                                                                                                                                                                  | pre-req (point DNS names to L4 LB)                                                                                                                                                                                          |
| HTTPS Certificate, DNS Name, and hostnames in BigBang's values.yaml must match in order for Ingress to work correctly.                                           | QuickStart leverages *.bigbang.dev HTTPS cert, and the BigBang Helm Chart's values.yaml's hostname defaults to bigbang.dev, just need to ensure multiple hostfile entries like "grafana.bigbang.dev <k3d VM's IP>" exist, or if you have access to DNS a wildcard entry to map *.bigbang.dev to k3d VM's IP | pre-req                                                                                                                                                                                                      | pre-req                                                                                                                                                                                                                     |
| SSO Identity Provider (pre-requisite for SSO Authentication Proxy feature)                                                                                       | PreSatisfied* (*depending on which quick start config is used), There's exists a demo SSO config that leverages P1's CAC enabled SSO, it's coded to only work for localhost to balance turn key demo functionality against security concerns.                                                               | pre-req (You don't have to use keycloak, you can use any OIDC Identity Provider) ([Customer Deployable Keycloak is a feature coming soon](https://repo1.dso.mil/platform-one/big-bang/bigbang/-/issues/291)) | pre-req (You don't have to use keycloak, you can use any OIDC Identity Provider) ([Customer Deployable Keycloak is a feature coming soon](https://repo1.dso.mil/platform-one/big-bang/bigbang/-/issues/291))                |
| Ops team to integrate, configure, and maintain BigBang in Production                                                                                             | NA for Demo                                                                                                                                                                                                                                                                                                 | pre-req* (*[P1 Customer Success can help with this](https://p1.dso.mil/#/services))                                                                                                                          | pre-req* (*[P1 Customer Success can help with this](https://p1.dso.mil/#/services))                                                                                                                                         |

**Table Notes:** 
1. OS Configuration Pre-Requisites:        
   * BigBang can work with selinux enforcing, but it requires additional OS configuration. 
   * The following OS configuration settings are usually required to make BigBang work:
     * `sudo sysctl -w vm.max_map_count=262144`    #(ECK crash loops without this)
     * `sudo setenforce 0`   #(Istio init-container crash loops without this if selinux is enabled) (WIP to remove this requirement in the future/consider disabling it a soft requirement)

2. Kubernetes Cluster Preconfigured to Best Practices:        
   * All Kubernetes Nodes and the LB associated with the kube-apiserver should all use private IPs.
   * In most case User Application Facing LBs should have Private IP Addresses and be paired with a defense in depth Ingress Protection mechanism like [P1's CNAP](https://p1.dso.mil/#/products/cnap/), a CNAP equivalent, VPN, VDI, port forwarding through a bastion, or air gap deployment. 
   * BigBang doesn't support PSPs (Pod Security Policies), because [PSP's are being removed from Kubernetes and will be gone by version 1.25.x](https://repo1.dso.mil/platform-one/big-bang/bigbang/-/issues/10), thus we recommened users disable them: 
     ```bash
     kubectl patch psp system-unrestricted-psp -p '{"metadata": {"annotations":{"seccomp.security.alpha.kubernetes.io/allowedProfileNames": "*"}}}'
     kubectl patch psp global-unrestricted-psp -p '{"metadata": {"annotations":{"seccomp.security.alpha.kubernetes.io/allowedProfileNames": "*"}}}'
     kubectl patch psp global-restricted-psp -p '{"metadata": {"annotations":{"seccomp.security.alpha.kubernetes.io/allowedProfileNames": "*"}}}'
     ```
   * Make sure CoreDNS in the kube-system namespace is HA with pod anti-affinity rules, master nodes are HA and tainted. 
   * Ideally you want to use a default storage class that allows worker nodes in different AZs to mount the same volume (AWS's EBS storage class has a limitation where a PVC in AZ1, can't automatically be mounted by a worker node in AZ2 if AZ1 goes down.)
   * Some BigBang apps allow overriding the storage class, so you can mix multiple storage classes.
   * Some apps require a RWX storage class for HA, so it may make sense to leverage both AWS's EBS storage class and their EFS-CSI storage class. Otherwise Cloud Agnostic Storage Class solutions. 

